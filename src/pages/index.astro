---
import yahooFinance from 'yahoo-finance';

import Layout from '../layouts/Layout.astro';
import Charts from '../components/Charts.vue';

const date = new Date();
const months = ["01", "02", "03", "04", "05", "06","07", "08", "09", "10", "11", "12"];

const fullDate = `${date.getFullYear()}-${months[date.getMonth()]}-${date.getDate() < 10 ? `0${date.getDate()}` : date.getDate()}`;
const fullFromDate = `${date.getFullYear() - 5}-${months[date.getMonth()]}-${date.getDate() < 10 ? `0${date.getDate()}` : date.getDate()}`;

const tickers = {
	ETF: {
		0: {
			ticker: "VUSA.AS",
			name: "Vanguard S&P 500 UCITS",
			data: {},
			logo: "assets/vanguard.png",
		},
		1: {
			ticker: "IWDA.AS",
			name: "iShares Core MSCI World UCITS",
			data: {},
			logo: "assets/ishares.jpg"
		},
		2: {
			ticker: "VWRL.AS",
			name: "Vanguard FTSE All-World UCITS",
			data: {},
			logo: "assets/vanguard.png",
		},
	},
	STOCKS: {
		0: {
			ticker: "ADYEN.AS",
			name: "Adyen N.V.",
			data: {},
			logo: "assets/adyen.png"
		},
		1: {
			ticker: "TKWY.AS",
			name: 'Just Eat Takeaway N.V.',
			data: {},
			logo: "assets/just-eat-takeaway.jpg"
		},
		2: {
			ticker: "AD.AS",
			name: "Ahold Delhaize N.V.",
			data: {},
			logo: "assets/ahold-delhaize.png"
		},
	}
}

for (let i = 0; i < Object.keys(tickers.ETF).length; i++) {
	const data = await yahooFinance.historical({
		symbol: tickers.ETF[i].ticker,
		from: fullFromDate,
		to: fullDate,
		period: 'm'
	}, function (err, quotes) {
		return quotes;
	});

	tickers.ETF[i].data = await data;
}

for (let i = 0; i < Object.keys(tickers.STOCKS).length; i++) {
	const data = await yahooFinance.historical({
		symbol: tickers.STOCKS[i].ticker,
		from: fullFromDate,
		to: fullDate,
		period: 'm'
	}, function (err, quotes) {
		return quotes;
	});

	tickers.STOCKS[i].data = await data;
}
---

<Layout title="Welcome to Astro.">
	<main>
		<div class="content">
			<Charts type="ETF's" tickers={tickers.ETF} client:load/>
		</div>
		<div class="content">
			<Charts type="aandelen" tickers={tickers.STOCKS} client:load/>
		</div>
	</main>
</Layout>

<style lang="scss">
	main {
		background-color: #f9fafb;
		padding-bottom: 50px;
	}
</style>
